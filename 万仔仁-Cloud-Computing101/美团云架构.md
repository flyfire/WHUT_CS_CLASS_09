# 美团云架构
美团云是美团基于python tornado架构完全自研的一套分布式计算资源管理系统

# 服务架构

![Image of cloud model](https://github.com/richardissuperman/sy0901/blob/master/万仔仁-Cloud-Computing101/images/cloud-model.png?raw=true)
云平台服务请求分为同步和异步请求，同步请求好理解，就是一些查询操作，API请求返回，整个请求过程就结束了。而异步请求到来之后会立即返回，之后云平台会通过task的方式来处理异步请求。云平台服务架构里的几个组件说明：
	* Model: 资源管理模块（如云主机、磁盘存储和宿主机等资源）
	* Task Manager: 任务管理模块，云平台对任何一种资源的操作都会以task的方式来处理，task定义为对特定资源的一系列操作。
	* Worker threads: 每一个task会提交给工作线程来处理。

接下来我将通过云主机（Guest）创建的实际例子来介绍云平台服务运行流程。
这里首先简化下一台云主机创建的流程：创建磁盘 -> 配置系统 -> 启动云主机（当然云主机实际创建流程肯定要比这复杂得多），这里云主机（Guest）创建涉及到另外一种资源－－Disk的创建，所以云主机创建的Task里又包含了创建磁盘的子Task。至此就完成了云主机创建任务－－GuestCreateTask的定义：
![Image of guestcreatetask](https://github.com/richardissuperman/sy0901/blob/master/万仔仁-Cloud-Computing101/images/guesttcreatetask.png?raw=true)
从Task定义的伪代码可以看出，一个Task可以包含多个子Task，Task每个操作也都包含1个或多个HTTP请求。因为Task每个操作都涉及到HTTP请求，为了保证每次HTTP请求返回之后，Task能继续上一次处理的步骤继续向下执行，云平台会记录每个Task执行的运行时参数以及当前执行到的步骤。
![Image of guestcreatetask-execute](https://github.com/richardissuperman/sy0901/blob/master/万仔仁-Cloud-Computing101/images/guesttcreatetask-execute.png?raw=true)

